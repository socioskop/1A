[1] "init at 2021-08-04 12:33:53"

> rm(list = ls()[!"echo" %in% ls()])

> source("./lib/load.R")

> d <- readxl::read_excel(Sys.getenv("1A"))

> colnames(d) <- c("id", "henv.dato", "cpr", "udr.dato", 
+     "diagnose", "samtykke", "beh.start", "MBSRstart", "beh.slut", 
+     "eftervrn.slut")

> d$id <- stringr::str_pad(d$id, 4, pad = "0")

> d$cpr <- gsub("-", "", d$cpr)

> d$index <- as.Date(d$udr.dato)

> d$treat <- "ONE"

> d$study <- "ONE"

> d$id[startsWith(d$id, "0")] <- paste0("7", substr(d$id, 
+     2, 4))

> d <- d[, c("cpr", "id", "index", "treat", "study")]

> saveRDS(d, "./data/1A")

> rm(list = ls()[!"echo" %in% ls()])

> source("./lib/load.R")

> load(Sys.getenv("ibbis_master"), x <- new.env())

> x <- x$ibbismaster

> load(Sys.getenv("ibbis_rct"), d <- new.env())

> d <- d$ibbisRCTgrand

> d <- d %>% mutate(across(where(is.character), ~na_if(., 
+     "")))

> d$id <- stringr::str_pad(d$pnumber, 4, pad = "0")

> d$index <- as.Date(d$asscompldate)

> d$treat <- d$randomresultpseudo

> d$study <- d$rctallocationopen

> key <- readxl::read_xlsx(Sys.getenv("dream_keys"))

> d$cpr <- gsub("-", "", key$cprnumber[match(d$id, key$pnumber)])

> ctrls <- d[d$treat == "INT" & !is.na(d$treat), c("cpr", 
+     "id", "index", "treat", "study", "sickleavedate")]

> saveRDS(ctrls, "./data/ctrls")

> saveRDS(d, "./data/IBBIS")

> rm(list = ls()[!"echo" %in% ls()])

> source("./lib/load.R")

> load(Sys.getenv("dream"), d <- new.env())

> d <- d$dreamfu24raw

> d$id <- stringr::str_pad(d$pnumber, 4, pad = "0")

> c <- colnames(d)

> ys <- c[substr(c, 1, 2) == "y_"]

> bs <- c[substr(c, 1, 8) == "branche_"]

> key <- readxl::read_xlsx(Sys.getenv("dream_keys"))

> d$cpr <- gsub("-", "", key$cprnumber[match(d$id, key$pnumber)])

> key <- readxl::read_excel(Sys.getenv("1A_keys"))

> d$cpr[d$id %in% key$pnumber] <- gsub("-", "", key$cprnumber)[match(d$id[d$id %in% 
+     key$pnumber], gsub("-", "", key$pnumber))]

> d <- d[, c("id", "cpr", ys, bs)]

> saveRDS(d, "./data/dream")

> rm(list = ls()[!"echo" %in% ls()])

> source("./lib/load.R")

> library(tidyverse)

> e <- bind_rows(readRDS("./data/IBBIS")[, c("cpr", 
+     "id", "index", "treat", "study", "sickleavedate")], readRDS("./data/1A")[, 
+     c("cpr", "id", "index", "treat", "study")])

> e <- merge(e, readRDS("./data/entry"), by = "id", 
+     all = T)

> e$male <- as.num(substr(e$cpr, 9, 10))

> e$male <- ifelse(e$male/2 != round(e$male/2), 1, ifelse(e$male/2 == 
+     round(e$male/2), 0, NA))

> e$age <- substr(e$cpr, 1, 6)

> e$age <- paste0(substr(e$age, 1, 2), "-", substr(e$age, 
+     3, 4), "-", ifelse(substr(e$age, 5, 6) > "20", "19", "20"), 
+     substr(e$age, 5, 6))

> e$age <- floor(as.num(as.Date(e$index.x) - as.Date(e$age, 
+     "%d-%m-%Y"))/365.25)

> e$cpr <- NULL

> e$id <- as.chr(e$id)

> plot(as.num(e$index.x), as.num(e$index.y))

> plot(as.num(e$index.w), as.num(e$index.y))

> summary(as.num(e$index.x) - as.num(e$index.y))
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
      0       0       0       0       0       0     830 

> summary(as.num(e$index.w) - as.num(e$index.y))
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  0.000   2.000   3.000   2.938   4.000   5.000     830 

> summary(as.num(e$index.w) - as.num(e$sgdp.date))
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
 -21.00   42.00   49.00   54.02   63.00  182.00     830 

> summary(as.num(e$sickleavedate) - as.num(e$sgdp.date))
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
-332.00  -26.00  -25.00  -25.72  -23.00   21.00     982 

> d <- readRDS("./data/process_dream")

> ta
